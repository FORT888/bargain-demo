<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>è”ä¿¡èµ„ Â· åŠ©åŠ›æŠ½å¥–</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  background:#f7f7f7;
  font-family:-apple-system,BlinkMacSystemFont,"PingFang SC";
}
.container{
  max-width:420px;
  margin:0 auto;
  padding:24px 16px 40px;
}

/* å“ç‰Œ */
.brand{
  text-align:center;
  margin-bottom:20px;
}
.brand h1{
  margin:0;
  font-size:30px;
  font-weight:800;
  letter-spacing:2px;
}
.brand p{
  margin:6px 0 0;
  font-size:14px;
  color:#999;
  letter-spacing:4px;
}

/* æ‰­è›‹æœº */
.gacha{
  margin:28px auto 14px;
  width:220px;
  height:220px;
  border-radius:50%;
  background:radial-gradient(circle at 30% 30%, #fff, #eaeaea);
  box-shadow:0 20px 40px rgba(0,0,0,.15);
  display:flex;
  align-items:center;
  justify-content:center;
}
.gacha::after{
  content:"";
  width:120px;
  height:120px;
  border-radius:50%;
  background:linear-gradient(#e60023,#c8001e);
  box-shadow:inset 0 -6px 0 rgba(0,0,0,.2);
}
.gacha.spin{
  animation:shake .8s ease;
}
@keyframes shake{
  0%{transform:rotate(0)}
  25%{transform:rotate(-6deg)}
  50%{transform:rotate(6deg)}
  75%{transform:rotate(-4deg)}
  100%{transform:rotate(0)}
}

/* ç»“æœ */
.result{
  text-align:center;
  font-size:20px;
  font-weight:700;
  margin:12px 0 4px;
  display:none;
}
.result.big{
  color:#e60023;
}

/* å¥–æ±  */
.pool{
  background:#fff;
  border-radius:16px;
  padding:16px;
  margin-top:22px;
}
.pool h3{
  margin:0 0 10px;
  font-size:16px;
}
.pool ul{
  list-style:none;
  padding:0;
  margin:0;
}
.pool li{
  padding:6px 0;
  font-size:14px;
  border-bottom:1px dashed #eee;
}
.pool li:last-child{border-bottom:none}

/* æŒ‰é’® */
.btn{
  margin-top:22px;
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:#e60023;
  color:#fff;
  font-size:16px;
  font-weight:600;
}
.btn:disabled{opacity:.6}
</style>
</head>

<body>
<div class="container">

  <div class="brand">
    <h1>è”ä¿¡èµ„</h1>
    <p>åŠ©åŠ›æŠ½å¥–</p>
  </div>

  <!-- æ‰­è›‹æœº -->
  <div class="gacha" id="gacha"></div>

  <!-- ç»“æœ -->
  <div class="result" id="resultText"></div>

  <!-- å¥–æ±  -->
  <div class="pool">
    <h3>æœ¬æ¬¡å¥–æ± </h3>
    <ul id="prizeList"></ul>
  </div>

  <button class="btn" id="drawBtn">å‘èµ·æŠ½å¥–</button>

</div>

<script>
/* ================= Firebase ================= */
firebase.initializeApp({
  apiKey: "AIzaSyA_GeAMtgqYBLG9z_EX529fVzmGYZbZl0Y",
  projectId: "cut-demo-e11b9"
});
const db = firebase.firestore();

const CREATE_API = "https://createactivity-23p22ouguq-uc.a.run.app";

/* ================= å¥–å“ä¸¥æ ¼æ˜ å°„è¡¨ ================= */
const PRIZE_MAP = {
  "66":   { label:"çº¢åŒ… 66 å…ƒ",   type:"cash" },
  "88":   { label:"çº¢åŒ… 88 å…ƒ",   type:"cash" },
  "388":  { label:"çº¢åŒ… 388 å…ƒ",  type:"cash" },
  "588":  { label:"çº¢åŒ… 588 å…ƒ",  type:"cash" },
  "888":  { label:"çº¢åŒ… 888 å…ƒ",  type:"cash" },
  "1888": { label:"çº¢åŒ… 1888 å…ƒ", type:"cash" },
  "iphone": { label:"è‹¹æœ 17 Pro Max", type:"big" },
  "rice": { label:"å¤§ç±³ä¸€è¢‹", type:"goods" },
  "oil":  { label:"é£Ÿç”¨æ²¹ä¸€æ¡¶", type:"goods" }
};

/* ================= DOM ================= */
const gacha = document.getElementById("gacha");
const result = document.getElementById("resultText");
const btn = document.getElementById("drawBtn");
const prizeList = document.getElementById("prizeList");

/* ================= å¥–æ± æ¸²æŸ“ ================= */
Object.values(PRIZE_MAP).forEach(p=>{
  const li = document.createElement("li");
  li.innerText = p.label;
  prizeList.appendChild(li);
});

/* ================= æ‰­è›‹æ¼”ç»ï¼ˆä¸éšæœºï¼‰ ================= */
function playGacha(prizeKey){
  const prize = PRIZE_MAP[prizeKey];
  if(!prize){
    console.error("æœªçŸ¥å¥–å“:", prizeKey);
    return;
  }

  result.style.display="none";
  result.className="result";

  gacha.classList.add("spin");

  setTimeout(()=>{
    gacha.classList.remove("spin");

    result.innerText = "ğŸ‰ æ­å–œè·å¾—ï¼š" + prize.label;
    result.style.display="block";

    if(prize.type === "big"){
      result.classList.add("big");
    }
  },800);
}

/* ================= è®¾å¤‡ ID ================= */
function genUUID(){
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,c=>{
    const r=Math.random()*16|0,v=c==='x'?r:(r&0x3|0x8);
    return v.toString(16);
  });
}
let deviceId = localStorage.deviceId || (localStorage.deviceId=genUUID());

/* ================= å‘èµ·æŠ½å¥– ================= */
btn.onclick = async ()=>{
  btn.disabled = true;

  const r = await fetch(CREATE_API,{
    method:"POST",
    headers:{ "x-device-id": deviceId }
  });
  const d = await r.json();

  if(!d.success){
    btn.disabled=false;
    alert(d.error || "åˆ›å»ºå¤±è´¥");
    return;
  }

  // â­ æ ¸å¿ƒï¼šåç«¯ç»™ä»€ä¹ˆï¼Œè¿™é‡Œå°±æ¼”ç»ä»€ä¹ˆ
  playGacha(d.prizeKey);
};
</script>

</body>
</html>




















