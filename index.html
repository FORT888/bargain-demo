<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>å¹¸è¿å¤§è½¬ç›˜</title>

<style>
body{
  text-align:center;
  font-family:"PingFang SC","Microsoft YaHei",Arial;
}

/* å®¹å™¨ */
.wheel-wrap{
  position:relative;
  width:400px;
  margin:20px auto;
}

/* é¡¶éƒ¨å›ºå®šæŒ‡é’ˆï¼ˆä½ ç»™çš„æ–¹æ¡ˆï¼‰ */
.pointer{
  width:0;
  height:0;
  border-left:15px solid transparent;
  border-right:15px solid transparent;
  border-bottom:30px solid red;
  position:absolute;
  top:-6px;
  left:50%;
  transform:translateX(-50%);
  z-index:10;
}

canvas{
  background:#fff;
  border-radius:50%;
  box-shadow:0 0 10px rgba(0,0,0,.2);
}

button{
  margin-top:20px;
  padding:10px 20px;
  font-size:16px;
}
</style>
</head>

<body>

<h2>å¹¸è¿å¤§è½¬ç›˜</h2>

<div class="wheel-wrap">
  <div class="pointer"></div>
  <canvas id="wheel" width="400" height="400"></canvas>
</div>

<button onclick="startSpin()">å¼€å§‹æ—‹è½¬ï¼ˆæ¨¡æ‹Ÿåç«¯ï¼‰</button>

<script>
/* ==================== è½¬ç›˜é…ç½® ==================== */

// å¥–å“ï¼ˆé¡ºåº = æ‰‡å½¢é¡ºåºï¼Œ**éå¸¸é‡è¦**ï¼‰
const PRIZES = [
  { key:"66",   label:"66å…ƒ" },
  { key:"88",   label:"88å…ƒ" },
  { key:"388",  label:"388å…ƒ" },
  { key:"588",  label:"588å…ƒ" },
  { key:"888",  label:"888å…ƒ" },
  { key:"1888", label:"1888å…ƒ" },
  { key:"iphone", label:"iPhone" }
];

const COLORS = [
  "#f44336","#ff9800","#ffeb3b",
  "#4caf50","#03a9f4","#9c27b0","#00bcd4"
];

const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");

const cx = canvas.width / 2;
const cy = canvas.height / 2;
const radius = 180;
const count = PRIZES.length;
const arc = 2 * Math.PI / count;

/* ==================== å½“å‰è§’åº¦ ==================== */
let currentAngle = 0;
let spinning = false;

/* ==================== ç»˜åˆ¶è½¬ç›˜ ==================== */
function drawWheel(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  for(let i=0;i<count;i++){
    const start = currentAngle + i * arc;
    const end = start + arc;

    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,radius,start,end);
    ctx.fillStyle = COLORS[i % COLORS.length];
    ctx.fill();

    // æ–‡å­—
    ctx.save();
    ctx.translate(
      cx + Math.cos(start + arc/2) * 120,
      cy + Math.sin(start + arc/2) * 120
    );
    ctx.rotate(start + arc/2);
    ctx.fillStyle="#000";
    ctx.font="14px Arial";
    ctx.fillText(PRIZES[i].label, -ctx.measureText(PRIZES[i].label).width/2, 0);
    ctx.restore();
  }
}

drawWheel();

/* ==================== æ ¸å¿ƒï¼šè½¬åˆ°æŒ‡å®šå¥–å“ ==================== */
function spinToPrize(prizeKey){
  if(spinning) return;
  spinning = true;

  // 1ï¸âƒ£ æ‰¾åˆ°åç«¯ç»™çš„å¥–å“ index
  const index = PRIZES.findIndex(p=>p.key===prizeKey);
  if(index < 0){
    alert("æœªçŸ¥å¥–å“");
    spinning = false;
    return;
  }

  // 2ï¸âƒ£ è®¡ç®—ç›®æ ‡è§’åº¦
  // æŒ‡é’ˆåœ¨ 12 ç‚¹æ–¹å‘ = -90Â°
  const target =
    360 * 4 +                       // å¤šè½¬å‡ åœˆ
    (360 - (index * 360 / count + 360 / count / 2));

  const start = currentAngle * 180 / Math.PI;
  const change = target - start;

  const duration = 3000;
  const startTime = performance.now();

  function animate(t){
    const progress = Math.min((t - startTime) / duration, 1);
    const ease = 1 - Math.pow(1 - progress, 3);

    const angleDeg = start + change * ease;
    currentAngle = angleDeg * Math.PI / 180;

    drawWheel();

    if(progress < 1){
      requestAnimationFrame(animate);
    }else{
      spinning = false;
      alert("ğŸ‰ æŠ½ä¸­ï¼š" + PRIZES[index].label);
    }
  }

  requestAnimationFrame(animate);
}

/* ==================== æ¨¡æ‹Ÿåç«¯è¿”å› ==================== */
function startSpin(){
  // ğŸ‘‰ çœŸå®æƒ…å†µï¼šè¿™é‡Œæ˜¯ fetch åç«¯æ¥å£
  // const res = await fetch(...)
  // const prizeKey = res.prizeKey;

  // ç°åœ¨æ¨¡æ‹Ÿåç«¯è¿”å›
  const mockPrizeKey = "888"; // â† åç«¯è¯´ä¸­ 888
  spinToPrize(mockPrizeKey);
}
</script>

</body>
</html>










