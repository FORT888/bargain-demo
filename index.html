<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>è”ä¿¡èµ„ Â· åŠ©åŠ›è½¬ç›˜</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  height:100vh;
  background:#f6f8fb;
  display:flex;
  justify-content:center;
  align-items:center;
  font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Microsoft YaHei",sans-serif;
}
.card{
  width:92%;
  max-width:420px;
  background:#fff;
  border-radius:28px;
  padding:20px 16px 26px;
  box-shadow:0 24px 60px rgba(0,0,0,.12);
  text-align:center;
}
h1{font-size:22px;margin:6px 0}
.sub{font-size:13px;color:#6b7280}

.prize-box{
  margin:10px 0;
  font-size:15px;
  font-weight:600;
}
.prize-box span{color:#e11d48}

/* ===== è¿›åº¦æ¡ ===== */
.progress-wrap{
  margin:12px 0;
}
.progress-text{
  font-size:13px;
  color:#374151;
  margin-bottom:6px;
}
.progress-bar{
  width:100%;
  height:10px;
  background:#e5e7eb;
  border-radius:999px;
  overflow:hidden;
}
.progress{
  height:100%;
  width:100%;
  background:linear-gradient(90deg,#2563eb,#60a5fa);
  transition:width .4s;
}

/* ===== è½¬ç›˜ ===== */
.wheel-wrap{
  width:320px;
  height:320px;
  margin:16px auto;
  position:relative;
}
canvas{
  width:100%;
  height:100%;
  border-radius:50%;
  transition:transform 3s cubic-bezier(.25,.9,.3,1);
}
.center{
  position:absolute;
  inset:50%;
  transform:translate(-50%,-50%);
  width:140px;
  height:140px;
  border-radius:50%;
  overflow:hidden;
  box-shadow:0 10px 30px rgba(0,0,0,.25);
}
.center img{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* ===== æŒ‰é’® ===== */
.btn{
  width:100%;
  margin-top:12px;
  padding:14px;
  border:none;
  border-radius:16px;
  font-size:16px;
  font-weight:600;
}
.primary{background:#2563eb;color:#fff}
.secondary{background:#f1f5ff;color:#2563eb}
button:disabled{
  background:#c7d2fe;
}

/* ===== åˆ†äº«é“¾æ¥ ===== */
.link-box{
  margin-top:10px;
  font-size:12px;
  color:#374151;
  word-break:break-all;
}

/* ===== å¼¹çª— ===== */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:999;
}
.modal-card{
  width:80%;
  max-width:300px;
  background:#fff;
  border-radius:20px;
  padding:22px;
  text-align:center;
  animation:pop .3s ease;
}
.modal-card h2{margin:0 0 6px}
.modal-card button{
  margin-top:14px;
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  background:#2563eb;
  color:#fff;
  font-size:15px;
}
@keyframes pop{
  from{transform:scale(.8);opacity:0}
  to{transform:scale(1);opacity:1}
}
</style>
</head>

<body>

<div class="card">
  <h1>è”ä¿¡èµ„ Â· åŠ©åŠ›è½¬ç›˜</h1>
  <div class="sub">å…ˆå¸®å¥½å‹åŠ©åŠ›ï¼Œå†å‘èµ·è‡ªå·±çš„æ´»åŠ¨</div>

  <div class="prize-box">
    å¥–å“ï¼š<span id="prizeText">æœªç¡®å®š</span>
  </div>

  <div class="progress-wrap">
    <div class="progress-text">
      å‰©ä½™åŠ©åŠ›è¿›åº¦ <span id="percentText">100%</span>
    </div>
    <div class="progress-bar">
      <div class="progress" id="progress"></div>
    </div>
  </div>

  <div class="wheel-wrap">
    <canvas id="wheel" width="320" height="320"></canvas>
    <div class="center">
      <img src="logo.png">
    </div>
  </div>

  <button class="btn secondary" id="btnHelp">å¸®åŠ©å¥½å‹åŠ©åŠ›</button>
  <button class="btn primary" id="btnCreate" disabled>å‘èµ·åŠ©åŠ›è¯•è¯•</button>

  <div class="link-box" id="linkBox"></div>
</div>

<!-- åŠ©åŠ›æˆåŠŸå¼¹çª— -->
<div class="modal" id="helpModal">
  <div class="modal-card">
    <h2>ğŸ‰ åŠ©åŠ›æˆåŠŸ</h2>
    <p>ä½ å·²æˆåŠŸå¸®åŠ©å¥½å‹åŠ©åŠ›</p>
    <button id="modalBtn">æˆ‘çŸ¥é“äº†</button>
  </div>
</div>

<script>
/* ===== Firebase é…ç½® ===== */
firebase.initializeApp({
  apiKey:"ä½ çš„",
  authDomain:"ä½ çš„",
  projectId:"ä½ çš„"
});

/* ===== æ¥å£ ===== */
const CREATE_API="https://createactivity-xxx";
const HELP_API="https://helpactivity-xxx";

/* ===== å¥–å“ ===== */
const PRIZES=[
  {key:"66",label:"çº¢åŒ…66å…ƒ",color:"#f87171"},
  {key:"88",label:"çº¢åŒ…88å…ƒ",color:"#fbbf24"},
  {key:"168",label:"çº¢åŒ…168å…ƒ",color:"#34d399"},
  {key:"388",label:"çº¢åŒ…388å…ƒ",color:"#60a5fa"},
  {key:"588",label:"çº¢åŒ…588å…ƒ",color:"#a78bfa"},
  {key:"888",label:"çº¢åŒ…888å…ƒ",color:"#fb7185"},
  {key:"iphone",label:"iPhone 17 Pro Max",color:"#f97316"}
];

/* ===== ç”»è½¬ç›˜ ===== */
const canvas=document.getElementById("wheel");
const ctx=canvas.getContext("2d");
const R=160;
const step=2*Math.PI/PRIZES.length;

PRIZES.forEach((p,i)=>{
  ctx.beginPath();
  ctx.moveTo(R,R);
  ctx.arc(R,R,R,i*step,(i+1)*step);
  ctx.fillStyle=p.color;
  ctx.fill();

  ctx.save();
  ctx.translate(R,R);
  ctx.rotate(i*step+step/2);
  ctx.fillStyle="#fff";
  ctx.font="bold 14px sans-serif";
  ctx.textAlign="right";
  ctx.fillText(p.label,R-14,6);
  ctx.restore();
});

let angle=0;
let helped=false;
let percent=100;
let activityId=new URLSearchParams(location.search).get("from");

function spinTo(index){
  const per=360/PRIZES.length;
  const target=360-(index*per+per/2);
  angle+=3*360+target;
  canvas.style.transform=`rotate(${angle}deg)`;
}

/* ===== å¸®å¥½å‹ ===== */
btnHelp.onclick=async()=>{
  if(!activityId){alert("è¯·é€šè¿‡å¥½å‹é“¾æ¥è¿›å…¥");return;}
  if(helped) return;

  helped=true;
  percent-=30;
  document.getElementById("progress").style.width=percent+"%";
  document.getElementById("percentText").innerText=percent+"%";
  document.getElementById("helpModal").style.display="flex";
  btnCreate.disabled=false;
};

/* ===== å…³é—­å¼¹çª— ===== */
modalBtn.onclick=()=>helpModal.style.display="none";

/* ===== å‘èµ· ===== */
btnCreate.onclick=async()=>{
  const idx=Math.floor(Math.random()*PRIZES.length);
  spinTo(idx);
  prizeText.innerText=PRIZES[idx].label;
  activityId="id"+Date.now();
  linkBox.innerText="åˆ†äº«é“¾æ¥ï¼š"+location.origin+location.pathname+"?from="+activityId;
};
</script>

</body>
</html>




