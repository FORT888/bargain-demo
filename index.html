<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>è”ä¿¡èµ„ Â· åŠ©åŠ›æŠ½å¥–</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  background:#f7f7f7;
  font-family:-apple-system,BlinkMacSystemFont,"PingFang SC";
}
.container{
  max-width:420px;
  margin:0 auto;
  padding:24px 16px 40px;
}

/* ===== å“ç‰Œ ===== */
.brand{
  text-align:center;
  margin-bottom:22px;
}
.brand img{
  width:68px;
  height:68px;
  display:block;
  margin:0 auto 10px;
  object-fit:contain;
}
.brand h1{
  margin:0;
  font-size:36px;
  font-weight:800;
  letter-spacing:8px;
}
.brand p{
  margin:10px 0 0;
  font-size:16px;
  color:#888;
  letter-spacing:12px;
}

/* ===== æŠ½å¥–æ ¸å¿ƒåœ† ===== */
.gacha{
  margin:28px auto 16px;
  width:220px;
  height:220px;
  border-radius:50%;
  background:radial-gradient(circle at top,#fff,#e2e6ef);
  box-shadow:0 22px 50px rgba(0,0,0,.18);
  position:relative;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
}

/* èƒ½é‡å±‚ */
.energy{
  position:absolute;
  bottom:0;
  width:100%;
  height:0%;
  background:linear-gradient(180deg,#ff4d4f,#e60023);
  transition:height .2s;
  z-index:1;
}

/* åœˆå†…æ–‡å­— */
.progress{
  position:relative;
  z-index:2;
  text-align:center;
  color:#333;
}
.progress strong{
  display:block;
  font-size:36px;
  font-weight:800;
}
.progress span{
  font-size:13px;
  color:#666;
}

.gacha.active{
  animation:flash .6s ease;
}
@keyframes flash{
  0%{box-shadow:0 0 0 rgba(230,0,35,0)}
  50%{box-shadow:0 0 60px rgba(230,0,35,.6)}
  100%{box-shadow:0 0 0 rgba(230,0,35,0)}
}

/* ===== ç»“æœ ===== */
.result{
  text-align:center;
  font-size:20px;
  font-weight:700;
  margin:14px 0 4px;
  display:none;
}
.result.big{
  color:#e60023;
}

/* ===== å¥–æ± ï¼ˆæœªæ”¹ï¼‰ ===== */
.pool{
  background:#fff;
  border-radius:16px;
  padding:16px;
  margin-top:22px;
}
.pool h3{
  margin:0 0 10px;
  font-size:16px;
}
.pool ul{
  list-style:none;
  padding:0;
  margin:0;
}
.pool li{
  padding:6px 0;
  font-size:14px;
  border-bottom:1px dashed #eee;
}
.pool li:last-child{border-bottom:none}

/* ===== æŒ‰é’® ===== */
.btn{
  margin-top:22px;
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:#e60023;
  color:#fff;
  font-size:16px;
  font-weight:600;
}
.btn:disabled{opacity:.6}
</style>
</head>

<body>
<div class="container">

  <!-- å“ç‰Œ -->
  <div class="brand">
    <!-- âš ï¸ ç¡®ä¿ logo.png ä¸æœ¬ HTML åœ¨åŒä¸€ç›®å½• -->
    <img src="./logo.png" alt="è”ä¿¡èµ„ Logo" />
    <h1>è”ä¿¡èµ„</h1>
    <p>åŠ©åŠ›æŠ½å¥–</p>
  </div>

  <!-- æŠ½å¥–åœ† -->
  <div class="gacha" id="gacha">
    <div class="energy" id="energy"></div>
    <div class="progress">
      <strong id="percent">0%</strong>
      <span>å®Œæˆè¿›åº¦</span>
    </div>
  </div>

  <!-- ç»“æœ -->
  <div class="result" id="resultText"></div>

  <!-- å¥–æ±  -->
  <div class="pool">
    <h3>æœ¬æ¬¡å¥–æ± </h3>
    <ul id="prizeList"></ul>
  </div>

  <button class="btn" id="drawBtn">å‘èµ·æŠ½å¥–</button>

</div>

<script>
/* ================= Firebaseï¼ˆæœªæ”¹ï¼‰ ================= */
firebase.initializeApp({
  apiKey: "AIzaSyA_GeAMtgqYBLG9z_EX529fVzmGYZbZl0Y",
  projectId: "cut-demo-e11b9"
});
const db = firebase.firestore();

const CREATE_API = "https://createactivity-23p22ouguq-uc.a.run.app";

/* ================= å¥–å“æ˜ å°„ï¼ˆæœªæ”¹ï¼‰ ================= */
const PRIZE_MAP = {
  "66":   { label:"çº¢åŒ… 66 å…ƒ",   type:"cash" },
  "88":   { label:"çº¢åŒ… 88 å…ƒ",   type:"cash" },
  "388":  { label:"çº¢åŒ… 388 å…ƒ",  type:"cash" },
  "588":  { label:"çº¢åŒ… 588 å…ƒ",  type:"cash" },
  "888":  { label:"çº¢åŒ… 888 å…ƒ",  type:"cash" },
  "1888": { label:"çº¢åŒ… 1888 å…ƒ", type:"cash" },
  "iphone": { label:"è‹¹æœ 17 Pro Max", type:"big" },
  "rice": { label:"å¤§ç±³ä¸€è¢‹", type:"goods" },
  "oil":  { label:"é£Ÿç”¨æ²¹ä¸€æ¡¶", type:"goods" }
};

/* ================= DOM ================= */
const gacha = document.getElementById("gacha");
const energy = document.getElementById("energy");
const percent = document.getElementById("percent");
const result = document.getElementById("resultText");
const btn = document.getElementById("drawBtn");
const prizeList = document.getElementById("prizeList");

/* ================= å¥–æ± æ¸²æŸ“ï¼ˆæœªæ”¹ï¼‰ ================= */
Object.values(PRIZE_MAP).forEach(p=>{
  const li = document.createElement("li");
  li.innerText = p.label;
  prizeList.appendChild(li);
});

/* ================= è®¾å¤‡ IDï¼ˆæœªæ”¹ï¼‰ ================= */
function genUUID(){
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,c=>{
    const r=Math.random()*16|0,v=c==='x'?r:(r&0x3|0x8);
    return v.toString(16);
  });
}
let deviceId = localStorage.deviceId || (localStorage.deviceId=genUUID());

/* ================= æŠ½å¥–é€»è¾‘ï¼ˆåªæ”¹å±•ç¤ºï¼‰ ================= */
btn.onclick = async ()=>{
  btn.disabled = true;
  result.style.display="none";
  energy.style.height="0%";
  percent.innerText="0%";

  let p = 0;
  const timer = setInterval(()=>{
    p += 5;
    energy.style.height = p + "%";
    percent.innerText = p + "%";
    if(p >= 100){
      clearInterval(timer);
      openPrize();
    }
  },50);
};

async function openPrize(){
  const r = await fetch(CREATE_API,{
    method:"POST",
    headers:{ "x-device-id": deviceId }
  });
  const d = await r.json();

  if(!d.success){
    btn.disabled=false;
    alert(d.error || "åˆ›å»ºå¤±è´¥");
    return;
  }

  const prize = PRIZE_MAP[d.prizeKey];

  gacha.classList.add("active");

  result.innerText = "ğŸ‰ æ­å–œè·å¾—ï¼š" + prize.label;
  result.style.display="block";

  if(prize.type === "big"){
    result.classList.add("big");
  }
}
</script>

</body>
</html>

